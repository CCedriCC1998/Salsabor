function notifCoursParticipants(t){$.post("functions/watch_participations.php").done(function(e){0==e?$("#badge-participants").hide():(e>$("#badge-participations").html()&&0!=t&&$.notify("Nouvelles participations non associées.",{globalPosition:"bottom right",className:"info"}),$("#badge-participations").show(),$("#badge-participations").html(e))})}function notifEcheancesDues(t){$.post("functions/watch_maturities.php").done(function(e){0==e?$("#badge-echeances").hide():(e>$("#badge-echeances").html()&&0!=t&&$.notify("De nouvelles échéances ont dépassé leur date.",{globalPosition:"bottom right",className:"info"}),$("#badge-echeances").show(),$("#badge-echeances").html(e))})}function badgeTasks(){$.post("functions/watch_tasks.php").done(function(t){0==t?$("#badge-tasks").hide():($("#badge-tasks").show(),$("#badge-tasks").html(t)),setTimeout(badgeTasks,1e4)})}function showNotification(t,e){$.notify(t,{globalPosition:"bottom right",className:e})}function checkMaturities(t){$.post("functions/check_unpaid.php",{search_id:t}).done(function(t){0!=t?($("#err_adherent").empty(),$("#unpaid").show(),$("#maturities-checked").hide()):($("#err_adherent").empty(),$("#unpaid").hide(),$("#maturities-checked").show())})}function addAdherent(){var t=$("#identite_prenom").val(),e=$("#identite_nom").val(),a=$("[name='rfid']").val(),o=$("#rue").val(),n=$("#code_postal").val(),s=$("#ville").val(),i=$("#mail").val(),l=$("#telephone").val(),r=$("#date_naissance").val();$.post("functions/add_adherent.php",{identite_prenom:t,identite_nom:e,rfid:a,rue:o,code_postal:n,ville:s,mail:i,telephone:l,date_naissance:r}).done(function(a){console.log(a);var o=JSON.parse(a);$(".has-name-completion:not(.completed)").val(t+" "+e),""!=window.miniCart&&(window.miniCart.id_beneficiaire=o.id,window.miniCart.nom_beneficiaire=t+" "+e),showNotification(o.success,"success"),$(":regex(id,^unknown-user)").hide("500")})}function checkHoliday(){var t=$("#date_debut").val();$.post("functions/check_holiday.php",{date_debut:t}).done(function(t){console.log(t),"0"!=t?($("#holiday-alert").empty(),$("#holiday-alert").append("Ce jour est chômé. Impossible d'ajouter une réservation à cette date."),$(".confirm-add").prop("disabled",!0)):($("#holiday-alert").empty(),$(".confirm-add").prop("disabled",!1),checkCalendar(!0,!1))})}function notifPanier(){if(null!=sessionStorage.getItem("panier")){var t=JSON.parse(sessionStorage.getItem("panier"));0==t.length?($("#badge-panier").hide(),$(".table-panier").empty()):($("#badge-panier").show(),$("#badge-panier").html(t.length),fillShoppingCart())}}function fillShoppingCart(){if($(".table-panier").empty(),null!=sessionStorage.getItem("panier")){var t=JSON.parse(sessionStorage.getItem("panier")),e=JSON.parse(sessionStorage.getItem("panier-noms")),a="";if(0!=t.length){for(var o=0;o<e.length;o++)a+="<tr>",a+="<td class='col-lg-11'>"+e[o]+"</td>",a+="<td class='col-lg-1'><span class='glyphicon glyphicon-trash glyphicon-button glyphicon-button-alt' onclick='removeCartElement("+o+")'></span></td>",a+="<tr>";$(".table-panier").append(a),composeURL(t[0])}}}function removeCartElement(t){var e=JSON.parse(sessionStorage.getItem("panier")),a=JSON.parse(sessionStorage.getItem("panier-noms"));e.splice(t,1),a.splice(t,1),sessionStorage.setItem("panier",JSON.stringify(e)),sessionStorage.setItem("panier-noms",JSON.stringify(a)),notifPanier()}function composeURL(t){var e="personnalisation.php?element=";e+=t,e+="&order=0",$("[name='next']").attr("href",e),$("[name='previous']").attr("href",e)}function addEntry(t,e){return $.post("functions/add_entry.php",{table:t,values:e})}function updateColumn(t,e,a,o){return $.post("functions/update_column.php",{table:t,column:e,value:a,target_id:o})}function updateEntry(t,e,a){return $.post("functions/update_entry.php",{table:t,target_id:a,values:e})}function deleteEntry(t,e){return $.post("functions/delete_entry.php",{table:t,entry_id:e})}function deleteTasksByTarget(t,e){return $.post("functions/delete_tasks_by_target.php",{token:t,target_id:e})}function logAction(t,e,a){return $.post("functions/log_action.php",{table:t,action:e,target_id:a})}function postNotification(t,e,a){return $.post("functions/post_notifications.php",{token:t,target:e,recipient:a})}function fetchColors(){return $.get("functions/fetch_colors.php")}function fetchLogs(t,e,a){$(t).trigger("loading"),$.get("functions/fetch_logs.php",{target:e,last_id:a}).done(function(o){a=renderLogs(t,o,a),console.log(a),setTimeout(fetchLogs,1e4,t,e,a)})}function renderLogs(t,e,a){$(t).trigger("loaded");var o=JSON.parse(e);console.log(a);for(var n=0;n<o.length;n++){var s="",i="",l="",r="",c="";switch(o[n].action){case"Ajout":i=" a ajouté",l="plus";break;case"Archivage":i=" a archivé";break;case"Connexion":i=" s'est connecté(e)",l="log-off";break;case"Déconnexion":i=" s'est déconnecté(e)",l="log-off";break;case"Désarchivage":i=" a désarchivé";break;case"Fermeture":i=" a fermé";break;case"Invalidation":i=" a invalidé";break;case"Modification":i=" a modifié",l="pencil";break;case"Prolongation":i=" a prolongé";break;case"Suppression":i=" a supprimé",l="trash";break;case"Transaction":i=" a conclu",l="refresh";break;case"Validation":i=" a validé"}switch(o[n].target_type){case"locations":r=" la région ",c="pushpin";break;case"participations":r=" la participation";break;case"product_categories":r=" la catégorie de produits ",c="list";break;case"produits":r=" le produit ",c="credit-card";break;case"produits_echeances":r=" l'échéance ",c="refresh";break;case"rooms":r=" la salle ",c="pushpin";break;case"sessions":r=" le cours ",c="eye-open";break;case"session_groups":r=" le groupe de récurrence ",c="eye-open";break;case"tags_session":r=" l'étiquette cours ",c="tags";break;case"tags_user":r=" l'étiquette utilisateur ",c="tags";break;case"tasks":r=" la tâche ",c="list-alt";break;case"task_comments":r=" un commentaire sur la tâche ",c="bubble";break;case"transactions":r=" la transaction ";break;case"users":r=" le profil de ",c="user"}s+="<div class='log-row' id='row-"+o[n].id+"' data-entry='"+o[n].id+"'>",s+="<span class='col-xs-1 centered'>",s+="<img class='log-picture' src='"+o[n].user_photo+"'>",s+="</span>",s+="<span>",s+="<strong>"+o[n].user_name+"</strong>",s+=i,"Connexion"!=o[n].action&&"Déconnexion"!=o[n].action&&(s+=r,s+=o[n].url?"<a href='"+o[n].url+"'>"+o[n].target_name+"</a>":o[n].target_name),s+="</span>",s+="<span class='timestamp'>"+moment(o[n].timestamp).fromNow()+"</span>",s+="</div>",a=o[n].id,$(t).prepend(s)}return a}function getUrlParameter(t){var e,a,o=decodeURIComponent(window.location.search.substring(1)),n=o.split("&");for(a=0;a<n.length;a++)if(e=n[a].split("="),e[0]===t)return void 0===e[1]?!0:e[1]}function provideAutoComplete(t,e){$.get("functions/fetch_user_list.php",{filter:e}).done(function(e){for(var a=JSON.parse(e),o=[],n=0;n<a.length;n++)o.push(a[n].user);$(t).textcomplete("destroy"),$(t).textcomplete([{match:/(^|\b)(\w{2,})$/,search:function(t,e){e($.map(o,function(e){return 0===e.toLowerCase().indexOf(t.toLocaleLowerCase())?e:null}))},replace:function(t){return t}}])})}function fillInvoiceSelect(t,e,a){console.log(t),$(t).empty(),$.get("functions/fetch_user_invoices.php",{user_credentials:e}).done(function(e){if(console.log(e),e){for(var o=JSON.parse(e),n=0;n<o.length;n++)$(t).append($("<option></option>").text(o[n].token).val(o[n].value));a&&$(t).val(a).change()}})}$(document).ready(function(){jQuery.expr[":"].regex=function(t,e,a){var o=a[3].split(","),n=/^(data|css):/,s={method:o[0].match(n)?o[0].split(":")[0]:"attr",property:o.shift().replace(n,"")},i="ig",l=new RegExp(o.join("").replace(/^s+|s+$/g,""),i);return l.test(jQuery(t)[s.method](s.property))},$('[data-toggle="tooltip"]').tooltip(),"/Salsabor/my/profile"!==top.location.pathname&&"/Salsabor/notifications/settings"!==top.location.pathname&&($.cssHooks.backgroundColor={get:function(t){function e(t){return("0"+parseInt(t).toString(16)).slice(-2)}if(t.currentStyle)var a=t.currentStyle.backgroundColor;else if(window.getComputedStyle)var a=document.defaultView.getComputedStyle(t,null).getPropertyValue("background-color");return-1==a.search("rgb")?a:(a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+e(a[1])+e(a[2])+e(a[3]))}});var t=0;window.numberProduits=1,notifCoursParticipants(t),notifEcheancesDues(t),notifPanier(),setInterval(notifCoursParticipants,3e4),setInterval(notifEcheancesDues,3e4),badgeNotifications(),badgeTasks(),moment.locale("fra");var e=[];$(".mandatory").each(function(){$(this).prev("label").append(" <span class='span-mandatory' title='Ce champ est obligatoire'>*</span>");var t=$(this).attr("name");e.push(t),$(this).parent().addClass("has-feedback"),$(this).parent().append("<span class='glyphicon form-control-feedback'></span>"),(""!=$(this).html()||""!=$(this).val())&&($(this).parent().addClass("has-success"),$(this).next("span").addClass("glyphicon-ok"))}).on("focus keyup change blur",function(){""!=$(this).html()||""!=$(this).val()?($(this).parent().removeClass("has-error"),$(this).parent().addClass("has-success"),$(this).next("span").removeClass("glyphicon-remove"),$(this).next("span").addClass("glyphicon-ok")):($(this).parent().removeClass("has-success"),$(this).parent().addClass("has-error"),$(this).next("span").removeClass("glyphicon-ok"),$(this).next("span").addClass("glyphicon-remove"));for(var t=0,a=0;a<e.length;a++)""!=$("[name="+e[a]+"]").val()||""!=$("[name="+e[a]+"]").html()?(t++,$(this).next().children("p").empty()):$(this).next().children("p").html("Ce champ est requis");t==e.length?($("#submit-button").prop("disabled",!1),$(".submit-button").prop("disabled",!1)):($("#submit-button").prop("disabled",!0),$(".submit-button").prop("disabled",!1))});var a=$("#filter-enabled tr");$("#search").keyup(function(){var t=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();a.show().filter(function(){var e=$(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(t)}).hide()}),$(".has-check").on("blur keyup focus",function(){var t=$(this),e=$(this).val(),a=$(this).attr("name").substr(12);$.post("functions/check_adherent.php",{identite:e}).done(function(o){if(console.log(o),0==o){if(0==$(":regex(id,^unknown-user)").length){var n="<div id='unknown-user"+a+"'>";n+="<p>Aucun résultat. Voulez vous inscrire cet adhérent ?</p>",n+="<a href='#user-details"+a+"' role='button' class='btn btn-info btn-block' value='create-user' id='create-user"+a+"' data-toggle='collapse' aria-expanded='false' aria-controls='userDetails'>Ouvrir le formulaire de création</a>",n+="<div id='user-details"+a+"' class='collapse'>",n+="<div class='well'>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<div class='form-group'>",n+="<label class='control-label'>Prénom</label><input type='text' name='identite_prenom' id='identite_prenom' class='form-control input-lg' placeholder='Prénom'>",n+="</div>",n+="</div>",n+="<div class='col-lg-6'>",n+="<div class='form-group'>",n+="<label class='control-label'>Nom</label><input type='text' name='identite_nom' id='identite_nom' class='form-control input-lg' placeholder='Nom'>",n+="</div>",n+="</div>",n+="</div>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<div class='form-group'>",n+="<label class='control-label'>Adresse postale</label><input type='text' name='rue' id='rue' placeholder='Adresse' class='form-control input-lg'>",n+="</div>",n+="</div>",n+="<div class='col-lg-3'>",n+="<div class='form-group'>",n+="<label class='control-label'>Code postal</label><input type='number' name='code_postal' id='code_postal' placeholder='Code Postal' class='form-control input-lg'>",n+="</div>",n+="</div>",n+="<div class='col-lg-3'>",n+="<div class='form-group'>",n+="<label class='control-label'>Ville</label><input type='text' name='ville' id='ville' placeholder='Ville' class='form-control input-lg'>",n+="</div>",n+="</div>",n+="</div>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<div class='form-group'>",n+="<label for='text' class='control-label'>Adresse mail</label><input type='email' name='mail' id='mail' placeholder='Adresse mail' class='form-control input-lg'>",n+="</div>",n+="</div>",n+="<div class='col-lg-6'>",n+="<div class='form-group'>",n+="<label for='telephone' class='control-label'>Numéro de téléphone</label><input type='tel' name='telephone' id='telephone' placeholder='Numéro de téléphone' class='form-control input-lg'>",n+="</div>",n+="</div>",n+="</div>",n+="<p class='help-block'><span class='glyphicon glyphicon-warning-sign'></span> Par défaut, la date d'inscription est celle du jour. Si vous voulez la modifier, n'oubliez pas de vous rendre sur le profil de l'utilisateur après la transaction</p>",n+="<a class='btn btn-primary btn-block' onClick='addAdherent()'>Inscrire l'adhérent</a>",n+="</div>",n+="</div>",n+="</div>",t.after(n)}}else $(":regex(id,^unknown-user)").remove(),$(".has-name-completion:not(.completed)").val(e)})}),$(".separate-scroll").on("DOMMouseScroll mousewheel",function(t){var e=$(this),a=this.scrollTop,o=this.scrollHeight,n=e.height(),s="DOMMouseScroll"==t.type?-40*t.originalEvent.detail:t.originalEvent.wheelDelta,i=s>0,l=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!i&&-s>o-n-a?(e.scrollTop(o),l()):i&&s>a?(e.scrollTop(0),l()):void 0})}).delegate('*[data-toggle="lightbox"]',"click",function(t){return t.preventDefault(),$(this).ekkoLightbox({onNavigate:!1})}).on("click",".submit-relay",function(){$(".submit-relay-target").click()}).on("focus",".name-input",function(){var t=$(this).data("filter");console.log(t),provideAutoComplete($(this),t)}).on("click",".sub-modal-close",function(){$(".sub-modal").toggle()}).on("click",".trigger-sub",function(t){t.stopPropagation(),$(".sub-modal").hide(0),$(".sub-modal-body").empty();var e=document.getElementById($(this).attr("id")),a=$(this).position(),o=e.dataset.subtype,n=$(this).offset();console.log(document.getElementById($(this).attr("id")));var s,i="",l="";switch(o){case"AREP":var r=e.dataset.argument;if(s="Prolonger",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success extend-product' data-argument='"+r+"' id='btn-sm-extend'>Prolonger</button>",moment(e.dataset.arep).isValid()){l+="<button class='btn btn-danger float-right btn-arep' data-argument='"+r+"' id='btn-sm-unextend'>Annuler AREP</button>";var c={format:"DD/MM/YYYY",inline:!0,locale:"fr",defaultDate:moment(e.dataset.arep)}}else var c={format:"DD/MM/YYYY",inline:!0,locale:"fr"};$(".sub-modal").css({top:a.top+136+"px",left:n.left+"px"}),$(".sub-modal-body").html(i);break;case"activate":var r=e.dataset.argument;s="Activer",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success activate-product' data-argument='"+r+"' id='btn-sm-activate'>Activer</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",inline:!0,locale:"fr"};break;case"deadline":var d=e.dataset.task;s="Date limite",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success task-deadline' data-task='"+d+"' id='btn-set-deadline'>Définir</button>",$(".sub-modal").css({top:n.top+25+"px",left:n.left+15+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY HH:mm",inline:!0,locale:"fr",stepping:15};break;case"set-participation-product":s="Changer le produit à utiliser";var p=e.dataset.participation,u={};u.participation_id=p,$.when(fetchProducts($.param(u))).done(function(t){var e=displayEligibleProducts(t);$(".sub-modal-body").html(e)}),l+="<button class='btn btn-success set-participation-product' id='btn-set-participation-product' data-participation='"+p+"'>Reporter</button>",l+=" <button class='btn btn-default btn-modal set-participation-product' id='btn-product-null-record' data-participation='"+p+"'><span class='glyphicon glyphicon-link'></span> Retirer</button>",$(".sub-modal").css({top:n.top+"px"}),$(".sub-modal").css(n.left>1e3?{left:n.left-350+"px"}:{left:n.left+20+"px"});break;case"change-participation":s="Changer le cours associé";var p=e.dataset.argument;$.when(fetchEligibleSessions(p)).done(function(t){console.log(t);var e=displayTargetSessions(t);$(".sub-modal-body").html(e)}),l+="<button class='btn btn-success report-participation' id='btn-session-changer-record' data-participation='"+p+"'>Changer</button>",$(".sub-modal").css({top:n.top+"px"}),$(".sub-modal").css(n.left>1e3?{left:n.left-350+"px"}:{left:n.left+20+"px"});break;case"delete":s="Supprimer une participation";var p=e.dataset.argument;i+="Êtes-vous sûr de vouloir supprimer cette participation ?",$(".sub-modal-body").html(i),l+="<button class='btn btn-danger delete-participation col-lg-6' id='btn-product-delete' data-session='"+p+"'><span class='glyphicon glyphicon-trash'></span> Supprimer</button><button class='btn btn-default col-lg-6'>Annuler</button>",$(".sub-modal").css(n.left>1e3?{left:n.left-350+"px"}:{left:n.left+20+"px"});break;case"delete-product":s="Supprimer un produit";var r=e.dataset.product;i+="ATTENTION : Si ce produit est seul dans une transaction, la transaction sera supprimée avec ce produit. Une fois validée, cette opération destructrice est irréversible. Êtes-vous sûr de vouloir supprimer ce produit ?",l+="<button class='btn btn-danger delete-product col-lg-6' id='btn-product-delete' data-product='"+r+"' data-dismiss='modal'><span class='glyphicon glyphicon-trash'></span> Supprimer</button><button class='btn btn-default col-lg-6'>Annuler</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);break;case"unlink":s="Délier une participation";var p=e.dataset.argument;i+="Êtes vous sûr de vouloir délier cette participation ? Vous la retrouverez dans les passages non régularisés",$(".sub-modal-body").html(i),l+="<button class='btn btn-default unlink-session col-lg-6' id='btn-product-unlink' data-session='"+p+"'><span class='glyphicon glyphicon-link'></span> Délier</button> <button class='btn btn-default col-lg-6'>Annuler</button>",$(".sub-modal").css(n.left>1e3?{left:n.left-350+"px"}:{left:n.left+20+"px"});break;case"receive-maturity":var m=e.dataset.maturity,h=$("#maturity-"+m+"-method>span").first().text();if(s="Réception de l'échéance",i+="<input type='text' class='form-control datepicker reception-date'/>",i+="<label class='control-label'>Méthode de paiement</label>",i+="<input type='text' class='form-control reception-method' value='"+h+"'></input>",l+="<button class='btn btn-success receive-maturity' data-maturity='"+m+"' id='btn-sm-receive'>Enregistrer</button>",l+="<button class='btn btn-danger cancel-reception float-right' data-maturity='"+m+"' id='btn-sm-cancel-receive'>Annuler réception</button>",""!=$("#reception-span-"+m).text())var g=moment($("#reception-span-"+m).text(),"DD/MM/YYYY");else var g=null;$(".sub-modal").css({top:n.top+"px"}),$(".sub-modal").css({left:n.left-200+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",defaultDate:g,inline:!0,locale:"fr"};break;case"bank-maturity":var m=e.dataset.maturity;if(s="Encaissement de l'échéance",i+="<input type='text' class='form-control datepicker bank-date'/>",l+="<button class='btn btn-success bank-maturity' data-maturity='"+m+"' id='btn-sm-receive'>Recevoir</button>",l+="<button class='btn btn-danger cancel-bank float-right' data-maturity='"+m+"' id='btn-sm-cancel-bank'>Annuler encaissement</button>",""!=$("#bank-span-"+m).text())var g=moment($("#bank-span-"+m).text(),"DD/MM/YYYY");else var g=null;$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",defaultDate:g,inline:!0,locale:"fr"};break;case"deadline-maturity":var m=e.dataset.maturity;if(s="Modifier la date limite",i+="<input type='text' class='form-control datepicker deadline-date'/>",l+="<button class='btn btn-success deadline-maturity' data-maturity='"+m+"' id='btn-sm-deadline'>Enregistrer</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i),""!=$("#deadline-maturity-span-"+m).text())var g=moment($("#deadline-maturity-span-"+m).text(),"DD/MM/YYYY");else var g=null;var c={format:"DD/MM/YYYY",defaultDate:g,inline:!0,locale:"fr"};break;case"user-tags":case"session-tags":var b=document.getElementById($(this).attr("id")).dataset.targettype,f=/^([a-z]+)/i.exec(o);window.target=$(this).attr("id"),s="Ajouter une étiquette",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),$(".sub-modal").css("/Salsabor/dashboard"===top.location.pathname?{top:n.top+25+"px",left:n.left-25+"px"}:{top:n.top+25+"px",left:n.left+25+"px"}),$.when(fetchTags(f[0])).done(function(t){var e=displayTargetTags(t,b,f[0]);$(".sub-modal-body").html(e)});break;case"edit-tag":var e=document.getElementById($(this).attr("id")).dataset.target,f=document.getElementById($(this).attr("id")).dataset.tagtype,v=$("#tag-"+e).text();s="Modifier une étiquette",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),$(".sub-modal").css({top:n.top+"px",left:n.left+45+"px"}),i+="<div class='input-group'>",i+="<input type='text' class='form-control' id='edit-tag-name' data-target='"+e+"' data-tagtype='"+f+"' placeholder='Nom de l&apos;étiquette' value='"+v+"'>",i+="<span class='input-group-btn'><button class='btn btn-success btn-tag-name' type='button'>Valider</button></span>",i+="</div>",$.when(fetchColors()).done(function(t){i+="<div class='container-fluid' id='colors'>";for(var a=JSON.parse(t),o=0;o<a.length;o++)i+="<div class='color-cube col-xs-3 col-md-3 col-lg-2' id='color-"+a[o].color_id+"' style='background-color:"+a[o].color_value+"' data-target='"+e+"'  data-tagtype='"+f+"'>","#"+a[o].color_value==$("#tag-"+e).css("backgroundColor")&&(i+="<span class='glyphicon glyphicon-ok color-selected'></span>"),i+="</div>";if(i+="</div>","session"==f){var n;n=$("#tag-"+e).find(".glyphicon-star").length>0?1:0,i+="<input name='is_mandatory' class='mandatory-tag-check' id='is_mandatory-"+e+"' data-target='"+e+"' value='"+n+"'> Obligatoire <span class='glyphicon glyphicon-question-sign' id='mandatory-tooltip' data-toggle='tooltip' title='Restreint la compatibilité produit/cours aux étiquettes obligatoires sélectionnées. Si un produit doit être compatible avec une couleur entière, n&apos;ajoutez pas d&apos;étiquette.'></span>"}$(".sub-modal-body").html(i),$("#is_mandatory-"+e).checkboxX({threeState:!1,size:"lg"}),$("#mandatory-tooltip").tooltip()});break;case"room-color":var e=document.getElementById($(this).attr("id")).dataset.target;s="Modifier la colueur de la salle",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),$(".sub-modal").css({top:n.top+"px",left:n.left+45+"px"}),$.when(fetchColors()).done(function(t){i+="<div class='row' id='colors'>";for(var a=JSON.parse(t),o=0;o<a.length;o++)i+="<div class='color-cube col-xs-4 col-md-3 col-lg-2' id='color-"+a[o].color_id+"' style='background-color:"+a[o].color_value+"' data-target='"+e+"' data-color='"+a[o].color_id+"'>","#"+a[o].color_value==$("#room-color-cube-"+e).css("backgroundColor")&&(i+="<span class='glyphicon glyphicon-ok color-selected'></span>"),i+="</div>";i+="</div>",$(".sub-modal-body").html(i)});break;default:s="Sub modal"}$(".sub-modal-title").text(s),$(".sub-modal-footer").html(l),$(".datepicker").datetimepicker(c);var y=/historique/i;if(null!=y.exec(top.location.pathname)&&(console.log("Historique"),$(".sub-modal").css({left:"74%"})),$(".modal").length>0)var k="col-xs-5 col-md-4 col-lg-3";else var k="col-xs-5 col-md-6 col-lg-3";$(".sub-modal").addClass(k),$(".sub-modal").show(0)}).on("change",".mandatory-tag-check",function(){var t=document.getElementById($(this).attr("id")).dataset.target,e=$(this).val();console.log("checkbox of tag "+t+" changed to "+e),$.when(updateColumn("tags_session","is_mandatory",e,t)).done(function(){1==e?$("#tag-"+t).prepend("<span class='glyphicon glyphicon-star'></span> "):$("#tag-"+t).remove($(".glyphicon-star")),logAction("tags_session","Modification",t)})}).on("click",".sub-menu-toggle",function(){console.log("toggling"),$(".small-sidebar-container").toggle()}).on("show.bs.modal","#edit-modal",function(t){t.stopPropagation();var e=$(t.relatedTarget).data("entry"),a=$(t.relatedTarget).data("transaction"),o=$(t.relatedTarget).data("table"),n=$(this);n.find(".modal-title").text($(t.relatedTarget).attr("title"));var s="<form class='form-horizontal' id='modal-form'>";$(".modal-editable-"+e).each(function(){var t=$(this),e=$(this).data("field"),a=$(this).data("name"),o=$(this).data("input"),n=$(this).data("placeholder");s+="<div class='form-group'>",s+="<label for='"+e+"' class='col-lg-4 control-label'>"+a+"</label>",s+="<div class='col-lg-8'>","rate_ratio"==e?(s+='<select name="'+e+'" class="form-control">',s+="heure"==t.text()?'<option selected="selected" value="heure">heure</option>':'<option value="heure">heure</option>',s+="personne"==t.text()?'<option selected="selected" value="personne">personne</option>':'<option value="personne">personne</option>',s+="prestation"==t.text()?'<option selected="selected" value="prestation">prestation</option>':'<option value="prestation">prestation</option>',s+="</select>"):void 0===o?(s+='<input type="text" class="form-control',void 0!==$(this).data("complete")?(console.log($(this).data("complete-filter")),s+=' name-input" data-filter="'+$(this).data("complete-filter")+'"'):s+='"',s+=' name="'+e+'"',s+=n?'placeholder="'+t.text()+'">':' value="'+t.text()+'">'):"textarea"==o&&(s+="<textarea class='form-control' name='"+e+"'>"+t.text()+"</textarea>"),s+="</div>",s+="</div>"}),s+="</form>",n.find(".edit-form-space").html(s),n.find(".send-edit-data").on("click",function(){var t=n.find("#modal-form").serialize();console.log(e);var s=/\D*/.exec(e);if(null===s||""==s||"transactions"==o){console.log("no chars");var i=e}else{console.log("chars");var i=e.replace(/(\D*)/i,"")}console.log("obtained entry: "+i),$.when(updateEntry(o,t,i)).done(function(){var t=n.find("#modal-form").serializeArray(),s=0;$(".modal-editable-"+e).each(function(){""!=t[s].value?($(this).text(t[s].value),$(this).data("placeholder",!1)):($(this).text("-"),$(this).data("placeholder",!0)),s++}),"produits_echeances"==o&&showAmountDiscrepancy(a),n.modal("hide"),showNotification("Modifications enregistrées","success")})})}).on("hide.bs.modal","#edit-modal",function(){console.log("unbinding edit button"),$(this).find(".send-edit-data").off("click")}).on("show.bs.modal","#delete-modal",function(t){var e=$(t.relatedTarget).data("entry"),a=$(t.relatedTarget).data("table"),o=$(t.relatedTarget).data("delete"),n=$(this);if("produits_echeances"==a)var s=$(t.relatedTarget).data("transaction");n.find(".modal-title").text($(t.relatedTarget).attr("title")),n.find(".modal-body").text("Êtes-vous sûr de vouloir supprimer cette entrée ?"),n.find(".delete-target").on("click",function(){console.log(e),$.when(deleteEntry(a,e)).done(function(t){console.log(t),$(o).remove(),s&&showAmountDiscrepancy(s),n.modal("hide"),showNotification("Suppression effectuée","success")})})}).on("hide.bs.modal","#delete-modal",function(){$(this).find(".delete-target").off("click")}).on("show.bs.modal","#archive-modal",function(t){var e=$(t.relatedTarget).data("entry"),a=$(t.relatedTarget).data("table"),o=$(this),n=$(t.relatedTarget);o.find(".archive-data").on("click",function(){$.when(updateColumn(a,"archived",1,e)).done(function(){if($(".user-legend").append("<span class='archived-state'>(Archivé)</span>"),"/Salsabor/regularisation/participations/all"===top.location.pathname){$("#participation-"+e).remove();var t=$(".irregular-participations-title>span").text();$(".irregular-participations-title>span").text(--t)}else n.replaceWith("<span class='col-xs-1 glyphicon glyphicon-folder-open glyphicon-button glyphicon-button-alt glyphicon-button-big dearchive-data' title='Désarchiver' data-entry='"+e+"' data-table='users'></span>");o.modal("hide"),logAction(a,"Archivage",e),showNotification("Entrée archivée","Success")})})}).on("hide.bs.modal","#archive-modal",function(){$(this).find(".archive-data").off("click")}).on("click",".dearchive-data",function(){var t=$(this).data("entry"),e=$(this).data("table");$.when(updateColumn(e,"archived",0,t)).done(function(){$(".archived-state").empty(),"/Salsabor/regularisation/participations/old"===top.location.pathname?$("#participation-"+t).remove():$(".dearchive-data").replaceWith("<span class='col-xs-1 glyphicon glyphicon-folder-close glyphicon-button glyphicon-button-alt glyphicon-button-big' title='Archiver' data-toggle='modal' data-target='#archive-modal' data-entry='"+t+"' data-table='users'></span>"),logAction(e,"Désarchivage",t),showNotification("Entrée désarchivée","Success")})}).on("click",".selectable",function(){var t=($(this),/([a-z]*-selectable)/gi.exec($(this).attr("class"))[0]);$("."+t).removeClass("selected"),$(this).addClass("selected")}).on("loading",".loading-container",function(){$(this).is(":empty")&&($(this).append("<img src='assets/img/loading.gif' class='loading-indicator'>"),console.log("Inserting loading gif in"+$(this)))}).on("loaded",".loading-container",function(){$(this).find(".loading-indicator").remove()}).on("keyup keypress",".no-submit",function(t){var e=t.keyCode||t.which;return 13===e?(t.preventDefault(),$(document.activeElement).blur(),!1):void 0}),$(".has-name-completion").on("click blur keyup",function(){""!=$(this).val()?$(this).addClass("completed"):$(this).removeClass("completed")}),$("*[date-today='true']").click(function(){var t=(new moment).format("YYYY-MM-DD");$(this).parent().prev().val(t),$(this).parent().prev().blur()});